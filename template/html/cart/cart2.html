<!DOCTYPE html>
<html>
<head>
<title>关于我们-国典寄卖行</title>
<link href="__STATIC__css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
<link href="https://cdn.bootcss.com/jqueryui/1.12.1/jquery-ui.min.css" rel="stylesheet">
<link href="__STATIC__css/style.css" rel="stylesheet" type="text/css" media="all" />
<link href="__STATIC__css/style2.css" rel="stylesheet" type="text/css" media="all" />
<link href="__STATIC__css/memenu.css" rel="stylesheet" type="text/css" media="all" />
<link href="__STATIC__css/form.css" rel="stylesheet" type="text/css" media="all" />
<link href="__STATIC__css/common.css" rel="stylesheet" type="text/css" media="all" />
<link href="__STATIC__css/contactUs_y.css?v=1" rel="stylesheet" type="text/css" media="all" />
<link href="__STATIC__css/edit_address.css" rel="stylesheet" type="text/css" media="all" />
<meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1,user-scalable=no" />
</head>
<body style="background-color: rgb(246, 246, 248);">
<!--header-s-->
<!--header-->
<include file="public/header"/>
<!--header-e-->
<div class="product-model contactPage main_artical">
  <div class="contact my-box">
    <div class="tabs">
      <div class="tab-content sixed" id="tab-detail3">
        <h3>购买方式</h3>
        <div class="y_detail">
          <div class="y_radio active">
            <input class="y_buy_choose" type="radio" name="y_buy" value="1" checked="checked">到店自提
          </div>
          <div class="y_radio1">
            <div class="y_radio1_item">自提地址： <span>北京市朝阳区铭记创意公园i2</span></div>
            <div class="y_radio1_item">营业时间： <span>9:00-18:00</span></div>
            <div class="y_radio1_item">贵宾专线： <span>010-80456828 转 8006</span></div>
            <div class="y_radio1_item">专车服务： <span>凭单号与客服预约</span><span class="y_juse">*专车服务需消费达到50,000元以上方可预约</span></div>
          </div>
          <div class="y_radio">
            <input class="y_buy_choose" type="radio" name="y_buy" value="2">快递送货
          </div>
        </div>

        <div class="y_detail y_radio2">
          <!-- <form action="" method="post" id="setting" style="padding: 0">
              <div class="formRow">
                <div class="label"><span class="y_red">* </span>收货人：</div>
                <div class="inputtext"><input class="text" type="text" name="nickname" value="" placeholder="请填写收货人代码"></div>
              </div>
              <div class="formRow">
                <div class="label"><span class="y_red">* </span>所在地：</div>
                <div class="inputtext distpicker">
                  <div data-toggle="distpicker">
                    <div class="form-group">
                      <label class="sr-only" for="province1">Province</label>
                      <select class="form-control" id="province1"></select>
                    </div>
                    <div class="form-group">
                      <label class="sr-only" for="city1">City</label>
                      <select class="form-control" id="city1"></select>
                    </div>
                    <div class="form-group">
                      <label class="sr-only" for="district1">District</label>
                      <select class="form-control" id="district1"></select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="formRow">
                <div class="label"><span class="y_red">* </span>详细地址：</div>
                <div class="inputtext address"><input class="text" type="text" name="address" value="" placeholder="请填写完整地区信息"></div>
              </div>
              <div class="formRow">
                <div class="label"><span class="y_red">* </span>手机号：</div>
                <div class="inputtext"><input class="text" type="text" name="nickname" value="" placeholder="请填写手机号"></div>
              </div>
                <input class="y_red_btn" id="submit" type="button" value="保存收货人信息">
            </form> -->

             <div class="fillorder">
                <div class="w1050">
                    <p class="tit">填写并核对订单信息</p>
                    <div class="spriteform" id="ajax_address"></div>
                </div>
            </div>
        </div>
        <h3>
          <ul class="title y_tab">
            <li class="details">商品名称</li>
            <li class="price">价格</li>
            <div class="depoist">数量</div>
            <li class="price">金额</li>
            <!-- <li class="opration">操作</li> -->
          </ul>
        </h3>
         
        <div class="y_detail">
          <ul class="items" id="list" style="padding:0;">
            <volist name="cartList" id="cart">
            <li class="y_item item y_tab">
              <div class="details y_tab">
                <a target="_blank" href="{:U('Home/Goods/goodsInfo',array('id'=>$cart['goods_id']))}"><img src="{$cart.goods_id|goods_thum_images=102,102}" alt="" style="width: 8rem;height:100px;"></a>
                <p style="width:calc(100% - 8rem)"><a target="_blank" href="{:U('Home/Goods/goodsInfo',array('id'=>$cart['goods_id']))}">{$cart.goods_name} {$cart[spec_key_name]}</a></p>
              </div>
              <div class="price"><span>{$cart.member_goods_price}</span>元</div>
              <div class="depoist"><span>{$cart.goods_num}</span></div>
              <div class="price"><span>{$cart.member_goods_price}</span>元</div>
              <!-- <div class="opration"><a href="javascript:;" class="buy">删除</a></div> -->
            </li>
            </volist>
          </ul>
        </div>
        <form name="cart2_form" id="cart2_form" method="post" autocomplete="off" style="display: none;">
            <input type="hidden" id="order_invoice_title" name="invoice_title" value="">
            <input type="hidden" id="order_taxpayer" name="taxpayer" value="">
            <input type="hidden" id="address_id" name="address_id" value="">
            <input type="hidden" name="pay_points" value="">
            <input type="hidden" name="user_money" value="">
            <!--立即购买才会用到-s-->
            <input type="hidden" name="action" value="{$Request.param.action}">
            <input type="hidden" name="goods_id" value="{$Request.param.goods_id}">
            <input type="hidden" name="item_id" value="{$Request.param.item_id}">
            <input type="hidden" name="goods_num" value="{$Request.param.goods_num}">
            <input type="hidden" name="auth_code" value="{$Think.config.AUTH_CODE}"/>
            <!--立即购买才会用到-e-->
            <input type="hidden" name="payPwd" value="">
            <input type="hidden" name="user_note" value="">
            <input type="hidden" name="buy_method" value="1">
            </volist>
        </form>
        <div class="y_detail_button">
          <p>商品数量总计： <span>1</span>件</p>
          <p>商品实付金额（不含税金和运费）： <span class="y_red" id="payables">0</span> <span>元</span></p>
          <div>
            <if condition="$Request.param.action == 'buy_now'">
            <else/>
            <button type="button" class="backCart" onclick="window.history.back()">返回修改购物车</button>
            </if>
            <button class="y_red_btn" onclick="submit_order();">提交订单</button>
          </div>
        </div>
        
      </div>
    </div>
    <div class="clearfix"></div>
  </div>
</div>
<!--footer-s-->
<include file="public/footer"/>
<!--footer-e-->
</body>
<script type="text/javascript" src="__STATIC__js/jquery.min.js"></script>
<script src="__STATIC__js/bootstrap.js"> </script>
<script src="__STATIC__js/responsiveslides.min.js"></script>
<script src="__STATIC__js/simpleCart.min.js"> </script>
<script type="text/javascript" src="__STATIC__js/memenu.js"></script>
<script defer src="__STATIC__js/jquery.flexslider.js"></script>
<script src="__STATIC__js/imagezoom.js"> </script>
<script src="__STATIC__js/common.js"> </script>



<script type="text/javascript">

    $(this).click(function(){
      var index = $(".y_radio .y_buy_choose:radio:checked").val();
      if (index == 1) {
        $('.y_radio').removeClass('active');
        $('.y_radio').first().addClass('active');

        $(".y_radio1").css("display","flex");
        $(".y_radio2").css("display","none")
        $('input[name=buy_methode]').val(1)
      } else if(index == 2){

        $('.y_radio').removeClass('active');
        $('.y_radio').last().addClass('active');

        $(".y_radio2").css("display","flex");
        $(".y_radio1").css("display","none")
        $('input[name=buy_method]').val(2)
        initAddress();
      }
    })

    $(function(){
        ajax_address(); // 获取收货地址
        ajax_order_price(); //计算订单价格
        
    })

    /**
     * 获取订单价格
     */
    function ajax_order_price() {
        $.ajax({
            type: "POST",
            url: "{:U('Home/Cart/cart3')}",
            dataType: 'json',
            data: $('#cart2_form').serialize(),
            success: function(data) {
                // if (data.status != 1) {
                //     layer.msg(data.msg, {
                //         icon: 2, // 成功图标
                //         time: 1000 //2秒关闭（如果不配置，默认是3秒）
                //     });
                //     // 登录超时
                //     if (data.status == -100) {
                //         location.href = "{:U('Home/User/login')}";
                //     }
                //     // 显示商品有货无货配送
                //     for (v in data.result.goods_shipping) {
                //         if (data.result.goods_shipping[v] != '' && data.result.goods_shipping[v] != null) {
                //             if (data.result.goods_shipping[v].status == 1) {
                //                 goods_shipping(v, true);
                //             } else {
                //                 console.log(v);
                //                 goods_shipping(v, false);
                //             }
                //         }
                //     }
                //     return false;
                // }


                $("#payables").text('￥' + data.result.payables);// 应付
            }
        });
    }

    /**
     * ajax 获取当前用户的收货地址列表
     */
    function ajax_address() {
        $.ajax({
            url: "{:U('Home/Cart/ajaxAddress')}", //+tab,
            success: function(data) {
                $("#ajax_address").empty().append(data);
                if (data != '') {
                    initAddress();
                }
            }
        });
    }

    // 提交订单
    var ajax_return_status = 1; // 标识ajax 请求是否已经回来 可以进行下一次请求
    function submit_order() {
        $('.user_note_txt').each(function() {
            $("input[name='user_note']").attr('value', $(this).val());
        })
        if (ajax_return_status == 0) {
            return false;
        }
        layer.load(1);
        ajax_return_status = 0;
        $.ajax({
            type: "POST",
            url: "{:U('Home/Cart/cart3')}", //+tab,
            data: $('#cart2_form').serialize() + "&act=submit_order", //
            dataType: "json",
            success: function(data) {
                layer.closeAll('loading');
                // 上一次ajax 已经返回, 可以进行下一次 ajax请
                ajax_return_status = 1;

                if (data.status != 1) {
                    layer.msg(data.msg, {
                        icon: 2,
                        time: 1000 //2秒关闭（如果不配置，默认是3秒）
                    });
                    // 登录超时
                    if (data.status == -100) {
                        location.href = "{:U('Home/User/login')}";
                    }
                    return false;
                }
                layer.msg('订单提交成功!', {
                    icon: 1, // 成功图标
                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                }, function() { // 关闭后执行的函数
                    layer.msg('正在前往支付页面...', {icon:1, time: 2000}, function(){
                        location.href = "/index.php?m=Home&c=Payment&a=getCode&pay_code=unionpay&order_id=" + data.result; // 跳转到结算页
                    })
                });
            }
        });
    }

    //设置收货地址
    function initAddress() {
        var address_item = $('.addressItem').find('.curtr').parents('.addressItem');
        var address_id = address_item.attr('data-address-id');
        var address_name = address_item.find('.addr-name').attr('title');
        var address_tel = address_item.find('.addr-tel').attr('title');

        $('#address_info').html(address_item.find('.addr-info').attr('title'));
        if(address_name && address_tel){
            $('#address_user').html(address_name + ' ' + address_tel);
        }
        $("input[name='address_id']").attr('value', address_id);
        if (address_item.length == 0) {
            // $('#addNewAddress').trigger('click'); 不自动弹出添加地址框
        } else {
            ajax_order_price(); // 计算订单价钱
        }
    }

     //收货人信息
    $(function() {
        $(document).on("click", '.addr-switch', function(e) {
            if ($(this).hasClass('switch-on')) {
                $(this).removeClass('switch-on');
                $(this).find('span').text('更多地址');
                $('.consignee-list').css('height', '42px');
                var addressItem = $('.consignee-list').find('.curtr').parents('.addressItem');
                $('.consignee-list').find('ul').prepend(addressItem.clone(true));
                addressItem.remove();
            } else {
                $(this).addClass('switch-on');
                $(this).find('span').text('收起地址');
                $('.consignee-list').css('height', 'inherit');
            }
        })
    })

     //选择收货地址
      $(function() {
          $(document).on("click", '.addressItem .item_select_t', function(e) {
              //如果本来没被选中
              if (!$(this).hasClass('curtr')) {
                  $('.addressItem').find('.item_select_t').each(function() {
                      $(this).removeClass('curtr');
                  })
                  $(this).addClass('curtr');
                  initAddress();
              }
          })
      })
</script>
</html>

